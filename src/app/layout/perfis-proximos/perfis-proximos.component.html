<!-- src/app/layout/perfis-proximos/perfis-proximos.component.html -->
<div class="container mt-3">
  <h2 class="profiles-title">Perfis Próximos</h2>

  <!-- Info sobre verificação de e-mail (sem acionar geolocation) -->
  @if (authService.user$ | async; as user) {
  @if (!user?.emailVerified) {
  <div class="alert alert-warning" role="status" aria-live="polite">
    Sua conta ainda não está verificada. A precisão da localização e o raio de busca
    estão limitados por segurança e privacidade.
  </div>
  }
  }

  @if (!userLocation) {
  <!-- CTA: só solicita geolocalização após gesto -->
  <div class="alert alert-info" role="status" aria-live="polite">
    Ative sua localização para listar perfis próximos respeitando sua privacidade e nível de acesso.
  </div>

  <button type="button" class="btn btn-primary" (click)="onEnableLocationClick()" aria-describedby="locHelpText">
    Ativar localização
  </button>

  <p id="locHelpText" class="form-text text-muted mt-2">
    A precisão e o raio de busca variam conforme seu plano e verificação de e-mail.
  </p>
  } @else {
  <!-- Controles de raio (capados pelo limite da policy) -->
  <div class="card mb-3" aria-labelledby="distControlTitle">
    <div class="card-body">
      <h3 class="h6 mb-3" id="distControlTitle">Ajustar raio de busca</h3>

      <div class="row align-items-center g-2">
        <div class="col-12 col-sm-8">
          <input type="range" class="form-range" [(ngModel)]="uiDistanceKm" [min]="1" [max]="policyMaxDistanceKm"
            [step]="1" aria-label="Raio de busca em quilômetros" />
        </div>

        <div class="col-12 col-sm-4">
          <div class="d-flex justify-content-between small text-muted">
            <span>1 km</span>
            <span>{{ uiDistanceKm ?? policyMaxDistanceKm }} / {{ policyMaxDistanceKm }} km máx.</span>
          </div>
        </div>
      </div>

      <p class="form-text mt-2">
        O valor selecionado é limitado ao máximo permitido pelo seu plano e status de verificação.
      </p>
    </div>
  </div>

  @if (profiles.length > 0) {
  <div class="profiles-row mt-3">
    @for (profile of profiles; track profile.uid) {
    <div class="profile-card">
      <app-user-card [user]="profile" [distanciaKm]="profile.distanciaKm ?? null">
      </app-user-card>
    </div>
    }
  </div>
  } @else {
  <p class="no-profiles text-center mt-4">Nenhum perfil próximo foi encontrado.</p>
  }
  }
</div>
