<!-- src/app/authentication/login-component/login-component.component.html -->
<div class="auth-container">
  <div class="form-container">
    <h2 class="form-header">Já tem conta?<br>Faça login</h2>

    <!-- Formulário de login usando Reactive Forms -->
  <form [formGroup]="loginForm" (ngSubmit)="login()" class="form" autocomplete="on" novalidate
    [attr.aria-busy]="isLoading ? 'true' : 'false'" aria-describedby="form-status">

      <!-- Campo de email -->
      <input formControlName="email" id="email" class="input-field" type="email" name="email" placeholder="Email" required
        autocomplete="email"
        [attr.aria-invalid]="loginForm.controls['email'].touched && loginForm.controls['email'].invalid ? 'true' : 'false'"
        [attr.aria-describedby]="loginForm.controls['email'].invalid ? 'email-error' : null" (focus)="clearError()" />

      <!-- Campo de senha -->
      <input formControlName="password" id="password" class="input-field" type="password" name="password"
        placeholder="Senha" required autocomplete="current-password"
        [attr.aria-invalid]="loginForm.controls['password'].touched && loginForm.controls['password'].invalid ? 'true' : 'false'"
        [attr.aria-describedby]="loginForm.controls['password'].invalid ? 'password-error' : null" (focus)="clearError()" />

      <!-- Honeypot -->
      <input formControlName="honeypot" class="honeypot-hidden" type="text" name="company" tabindex="-1" aria-hidden="true"
        autocomplete="off" />

      <!-- Lembrar de mim -->
      <div class="remember-me">
        <input type="checkbox" id="rememberMe" formControlName="rememberMe" />
        <label for="rememberMe">Lembrar de mim</label>
      </div>

      <!-- Botão de login -->
    <div class="button-container">
      <!-- habilita com campos preenchidos (mesmo inválidos) -->
      <button class="btn btn-primary" type="submit" [disabled]="isLoading || !(hasRequiredFields$ | async)"
        [attr.aria-disabled]="(isLoading || !(hasRequiredFields$ | async)) ? 'true' : 'false'">
        {{ isLoading ? 'Aguarde...' : 'Login' }}
      </button>
    </div>

            <!-- Spinner de carregamento -->
      @if (isLoading) {
      <div class="loading-overlay" aria-hidden="true">
        <div class="spinner"></div>
      </div>
      }

      <!-- Mensagem de erro geral -->
      @if (errorMessage) {
      <p id="form-status" class="alert alert-error" role="alert" aria-live="assertive">
        {{ errorMessage }}
      </p>
      }

      <!-- Link para resetar senha -->
      <button class="forgot-password btn-link" type="button" (click)="openPasswordRecoveryModal()"
        [disabled]="isLoading">
        Esqueci minha senha
      </button>

      <!-- Link para registro -->
      <p class="register-link">
        Não tem uma conta?
        <a [routerLink]="['/register']">Cadastre-se</a>
      </p>
    </form>
  </div>

  <!-- Modal de verificação de e-mail -->
  @if (showEmailVerificationModal) {
  <div class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="verify-title"
    aria-describedby="verify-desc">
    <div class="modal-content">
      <h2 id="verify-title">Verificação de E-mail</h2>
      <p id="verify-desc">
        Seu e-mail ainda não foi verificado. Por favor, verifique sua caixa de entrada
        ou reenvie o link de verificação.
      </p>
      <div class="modal-actions">
        <button class="btn btn-primary" type="button" (click)="resendVerificationEmail()">Reenviar E-mail de
          Verificação</button>
        <button class="btn btn-danger" type="button" (click)="logout()">Sair</button>
      </div>
    </div>
  </div>
  }

  <!-- Modal de recuperação de senha -->
  <app-email-input-modal></app-email-input-modal>
</div>
