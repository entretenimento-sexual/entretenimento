<!-- src/app/header/links-interaction/links-interaction.component.html -->
@if (isLogged$ | async) {
<nav class="links-bar" aria-label="AÃ§Ãµes rÃ¡pidas">
  <a class="link" [routerLink]="['/chat', (userId$ | async)]" aria-label="Salas de Bate-Papo">
    <i class="fas fa-comments" aria-hidden="true"></i>
    <span class="label">Bate-Papo</span>
    @if (unreadMessagesCount$ | async; as unread) { @if (unread > 0) {
    <span class="badge" [attr.aria-label]="unread + ' mensagens nÃ£o lidas'">{{ unread }}</span>
    }}
  </a>

  <span class="dot" aria-hidden="true">Â·</span>

  <button class="link" type="button" (click)="onUploadPhotoClick()" aria-label="Enviar Foto">
    <i class="fas fa-upload" aria-hidden="true"></i>
    <span class="label">Enviar Foto</span>
  </button>

  <span class="dot" aria-hidden="true">Â·</span>

  <a class="link" [routerLink]="['/invites']" aria-label="Convites">
    <i class="fas fa-user-plus" aria-hidden="true"></i>
    <span class="label">Convites</span>
    @if (pendingInvitesCount$ | async; as invites) { @if (invites > 0) {
    <span class="badge" [attr.aria-label]="invites + ' convites pendentes'">{{ invites }}</span>
    }}
  </a>

  <!-- ðŸ”” Mini-inbox -->
<button class="icon-btn" mat-icon-button matBadgePosition="above after" matBadgeSize="small" matBadgeOverlap="true"
  [matBadge]="(pendingFriendReqCount$ | async) || 0" [matBadgeHidden]="!((pendingFriendReqCount$ | async) || 0)"
  matBadgeColor="warn" [matMenuTriggerFor]="reqMenu" (menuOpened)="refreshInboundOnOpen()">
  <mat-icon aria-hidden="true">person_add</mat-icon>
  <span class="sr-only">SolicitaÃ§Ãµes</span>
</button>

  <mat-menu #reqMenu="matMenu" class="menu-requests-panel"
            [overlapTrigger]="false"
            xPosition="after"
            yPosition="below">
    <div class="menu-hd">
      <strong>SolicitaÃ§Ãµes</strong>
      <a class="view-all" [routerLink]="['/friends','requests']">Ver todas</a>
    </div>

    @if (inboundRequestsVM$ | async; as list) {
    @if (list.length === 0) {
    <div class="menu-empty">Sem pendÃªncias</div>
    } @else {
    @for (req of list.slice(0,5); track req.id) {
    <div class="req" role="group" (click)="$event.stopPropagation()">
      <div class="avatar">
        <img *ngIf="req.avatarUrl; else defAvatar" [src]="req.avatarUrl" alt="" />
        <ng-template #defAvatar><mat-icon>person</mat-icon></ng-template>
      </div>

      <div class="body">
        <div class="name">{{ req.nickname }}</div>
        @if (req.message) { <div class="msg">{{ req.message }}</div> }
        <div class="acts">
          <button mat-icon-button aria-label="Aceitar" (click)="accept(req); $event.stopPropagation()">
            <mat-icon>check</mat-icon>
          </button>
          <button mat-icon-button color="warn" aria-label="Recusar" (click)="decline(req); $event.stopPropagation()">
            <mat-icon>close</mat-icon>
          </button>
          <button mat-icon-button aria-label="Bloquear" (click)="block(req); $event.stopPropagation()">
            <mat-icon>block</mat-icon>
          </button>
        </div>
      </div>
    </div>
    }
    <button mat-menu-item [routerLink]="['/friends','requests']">
      <mat-icon>open_in_new</mat-icon>
      Abrir caixa inteira
    </button>
    }
    }
  </mat-menu>
</nav>
}
