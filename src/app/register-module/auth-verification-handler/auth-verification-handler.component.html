<!-- src/app/authentication/auth-verification-handler/auth-verification-handler.component.html -->
<div class="auth-container">
  <!-- Loading -->
  @if (isLoading) {
  <div class="loading-message">
    <p>Aguarde, estamos processando sua solicitação…</p>
  </div>
  }

  <!-- Mensagem principal -->
  @if (!isLoading && message) {
  <div class="alert-container">
    <p class="alert" [ngClass]="{ 'alert-success': verifyOk, 'alert-error': !verifyOk }">
      {{ message }}
    </p>

    <!-- CTAs contextuais para verificação de e-mail -->
    @if (mode === 'verifyEmail') {
    <div class="cta-row">
      @if (verifyOk && !showGoToLoginCTA) {
      <button class="btn btn-primary" (click)="goToWelcome()">Ir para o welcome</button>
      }
      @if (showGoToLoginCTA) {
      <button class="btn btn-primary" (click)="goToLogin()">Ir para o login</button>
      }
      @if (showResendVerifyCTA) {
      <button class="btn btn-secondary" (click)="resendVerificationEmail()">Reenviar e-mail de verificação</button>
      }
      <button class="btn" (click)="redirectToFAQ()">Perguntas frequentes</button>
    </div>
    }
  </div>
  }

  <!-- Fluxo: verificação de e-mail -->
  @if (!isLoading && mode === 'verifyEmail') {
  <!-- Nada adicional fixo aqui; a mensagem + CTAs acima já cobrem todos os casos -->
  }

  <!-- Fluxo: redefinição de senha -->
  @if (!isLoading && mode === 'resetPassword') {
  <div class="form-container">
    <h2 class="form-header">Redefinir Senha</h2>
    <form (ngSubmit)="onSubmit()" class="form">
      <label for="newPassword" class="form-label">Nova Senha</label>
      <div class="input-wrapper">
        <input [type]="showPassword ? 'text' : 'password'" [(ngModel)]="newPassword" name="newPassword" required
          class="input-field" />
        <button type="button" class="toggle-input" (click)="togglePasswordVisibility()">
          <i [ngClass]="showPassword ? 'fa fa-eye-slash' : 'fa fa-eye'"></i>
        </button>
      </div>

      <label for="confirmPassword" class="form-label">Confirmar Nova Senha</label>
      <div class="input-wrapper">
        <input [type]="showConfirmPassword ? 'text' : 'password'" [(ngModel)]="confirmPassword" name="confirmPassword"
          required class="input-field" />
        <button type="button" class="toggle-input" (click)="toggleConfirmPasswordVisibility()">
          <i [ngClass]="showConfirmPassword ? 'fa fa-eye-slash' : 'fa fa-eye'"></i>
        </button>
      </div>

      <button type="submit" class="btn btn-primary">Redefinir Senha</button>
    </form>

    @if (shouldShowRecoveryLink) {
    <div class="hint-row">
      <button class="link-button" (click)="openPasswordRecoveryModal()">
        Reenviar e-mail para recuperação de senha
      </button>
    </div>
    }
  </div>
  }

  <!-- Modal de recuperação de senha -->
  <app-email-input-modal></app-email-input-modal>
</div>
