<!-- src/app/authentication/register-module/welcome/welcome.component.html -->
<div class="welcome-container">
  <header class="welcome-header">
    <h1>Confirme seu e-mail para come√ßar</h1>
    <p class="subtitle" id="welcome-subtitle">
      Enviamos um link de verifica√ß√£o para <strong>{{ email || 'seu e-mail' }}</strong>.
      Assim que voc√™ confirmar, liberamos todos os recursos.
    </p>
  </header>

  <!-- Banner robusto (usa .alert global + sem inline styles) -->
  <div *ngIf="banner as b" class="alert welcome-alert" [ngClass]="{
      'alert-info': b.variant === 'info',
      'alert-error': b.variant === 'error',
      'alert-success': b.variant === 'success',
      'alert-warning': b.variant === 'warn'
    }" [attr.role]="(b.variant === 'error' || b.variant === 'warn') ? 'alert' : 'status'"
    [attr.aria-live]="(b.variant === 'error' || b.variant === 'warn') ? 'assertive' : 'polite'" aria-atomic="true">
    <strong class="welcome-alert__title">{{ b.title }}</strong>
    <span class="welcome-alert__msg">{{ b.message }}</span>

    <div *ngIf="lastCheckedAt" class="welcome-alert__meta">
      √öltima checagem: {{ lastCheckedAt | date:'shortTime' }}
    </div>

    <div class="actions">
      <button class="btn btn-secondary" (click)="checkNow()" [disabled]="busy" [attr.aria-busy]="busy">
        {{ busy ? 'Checando‚Ä¶' : 'Checar agora' }}
      </button>

      <button class="btn" (click)="resendVerificationEmail()" [disabled]="busy" [attr.aria-busy]="busy">
        {{ busy ? 'Reenviando‚Ä¶' : 'Reenviar e-mail' }}
      </button>

      <button class="btn btn-ghost" (click)="openInbox()">Abrir seu e-mail</button>
      <button class="btn btn-ghost" (click)="copyEmail()" [disabled]="!email">Copiar e-mail</button>

      <button class="btn btn-ghost" (click)="toggleTech()">
        {{ showTech ? 'Ocultar detalhes' : 'Mostrar detalhes t√©cnicos' }}
      </button>

      <button class="btn btn-ghost" (click)="reloadPage()">Recarregar</button>
      <button class="btn btn-ghost" (click)="restartRegistration()">Refazer cadastro</button>

      <button class="btn btn-primary" *ngIf="emailVerified" (click)="proceedToDashboard()">
        Ir para o painel
      </button>
    </div>

    <pre *ngIf="showTech && b.details" class="tech-details">{{ b.details }}</pre>
  </div>

  <main class="welcome-content" [attr.aria-describedby]="'welcome-subtitle'">
    <section class="welcome-card">
      <h2 class="card-title">
        Status:
        <span *ngIf="emailVerified; else notVerified" class="badge ok">verificado</span>
        <ng-template #notVerified><span class="badge warn">n√£o verificado</span></ng-template>
      </h2>

      <ol class="steps">
        <li>Abra sua caixa de entrada.</li>
        <li>Procure pelo e-mail ‚ÄúConfirme seu endere√ßo‚Äù.</li>
        <li>Clique no bot√£o do e-mail para confirmar.</li>
      </ol>

      <div class="actions">
        <button class="btn btn-primary" (click)="checkNow()" [disabled]="busy" [attr.aria-busy]="busy">
          {{ busy ? 'Checando‚Ä¶' : 'J√° verifiquei ‚Äî checar agora' }}
        </button>
        <button class="btn btn-secondary" (click)="resendVerificationEmail()" [disabled]="busy" [attr.aria-busy]="busy">
          {{ busy ? 'Reenviando‚Ä¶' : 'Reenviar e-mail' }}
        </button>
        <button class="btn" (click)="proceedToDashboard()" [disabled]="busy || !emailVerified">
          Ir para o painel
        </button>
      </div>
    </section>

    <!-- Onboarding opcional -->
    <details class="welcome-card details-optional">
      <summary>Quero adiantar meu perfil (opcional)</summary>

      <div class="optional-grid">
        <div>
          <label class="form-label" for="genderSelect">Identidade de g√™nero (opcional)</label>
          <select id="genderSelect" class="input-field" [(ngModel)]="selectedGender"
            [ngModelOptions]="{ standalone: true }" aria-label="Selecione seu g√™nero">
            <option value="" disabled>Selecione seu g√™nero (opcional)</option>
            <option *ngFor="let gender of validGenders" [value]="gender">{{ gender }}</option>
          </select>
        </div>

        <div>
          <span class="form-label" id="prefsLabel">O que voc√™ gostaria de encontrar? (opcional)</span>

          <div class="checkbox-group" role="group" aria-labelledby="prefsLabel">
            <label class="checkbox-item" *ngFor="let preference of validPreferences">
              <input type="checkbox" [(ngModel)]="selectedPreferencesMap[preference]"
                [ngModelOptions]="{ standalone: true }" />
              {{ preference }}
            </label>
          </div>
        </div>
      </div>

      <div class="actions right">
        <button class="btn btn-primary" (click)="saveOptionalProfile()" [disabled]="savingOptional || busy"
          [attr.aria-busy]="savingOptional">
          {{ savingOptional ? 'Salvando‚Ä¶' : 'Salvar prefer√™ncias' }}
        </button>
      </div>
    </details>

    <section *ngIf="emailVerified" class="welcome-card success-card">
      <h2 class="card-title">Tudo certo! üéâ</h2>
      <p>Seu e-mail est√° verificado. Voc√™ pode seguir para o painel quando quiser.</p>
      <div class="actions">
        <button class="btn btn-primary" (click)="proceedToDashboard()">Ir para o painel</button>
      </div>
    </section>

    <!-- Sess√£o inv√°lida -->
    <section *ngIf="sessionInvalid" class="welcome-card card-error" role="alert" aria-live="assertive"
      aria-atomic="true">
      <h2 class="card-title">Sess√£o encerrada</h2>
      <p>N√£o conseguimos manter sua sess√£o ativa durante a verifica√ß√£o. Voc√™ pode tentar reconectar ou refazer o
        cadastro.</p>
      <div class="actions">
        <button class="btn btn-secondary" (click)="checkNow()" [disabled]="busy" [attr.aria-busy]="busy">
          Tentar reconectar
        </button>
        <button class="btn btn-primary" (click)="restartRegistration()">Refazer cadastro</button>
      </div>
    </section>
  </main>
</div>
