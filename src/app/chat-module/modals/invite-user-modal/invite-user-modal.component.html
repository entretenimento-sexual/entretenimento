<!-- src\app\chat-module\invite-user-modal\invite-user-modal.component.html -->
<app-base-modal title="Convidar Usu√°rios" (closeModal)="dialogRef.close()">
  <!-- Barra de busca -->
  <div class="search-container">
    <input type="text" [(ngModel)]="searchTerm" (input)="onFilterChange()"
      placeholder="Digite um nome para buscar usu√°rios..." class="input-field" />
      <span class="search-icon" (click)="onFilterChange()">üîç</span>
    </div>

    <!-- Filtros adicionais -->
    <div class="filters-container">
      <label class="region-container">
        Regi√£o:
        <select [(ngModel)]="selectedRegion.uf" (change)="onRegionChange()" class="input-field"
          [disabled]="!isRegionFieldEditable()">
          <option value="">Selecione o Estado</option>
          @for (uf of availableStates; track uf) {
            <option [value]="uf">{{ uf }}</option>
          }
        </select>

        <select [(ngModel)]="selectedRegion.city" (change)="onFilterChange()" class="input-field"
          [disabled]="!isRegionFieldEditable() || !selectedRegion.uf">
          <option value="">Selecione a Cidade</option>
          @for (city of availableCities; track city) {
            <option [value]="city">{{ city }}</option>
          }
        </select>
      </label>

      <label>
        G√™nero:
        <select [(ngModel)]="selectedGender" (change)="onFilterChange()" class="input-field">
          <option value="">Todos</option>
          @for (gender of availableGenders; track gender) {
            <option [value]="gender">
              {{ gender | titlecase }}
            </option>
          }
        </select>
      </label>
    </div>

    <!-- Resultados -->
    @if (!isLoading && availableUsers.length === 0 && !(searchTerm || selectedGender || selectedRegion.uf || selectedRegion.city)) {
      <div
        >
        <p>Use os filtros acima para encontrar usu√°rios.</p>
      </div>
    }
    @if (!isLoading && availableUsers.length === 0 && (searchTerm || selectedGender || selectedRegion.uf || selectedRegion.city)) {
      <div
        >
        <p>Nenhum usu√°rio encontrado para os crit√©rios aplicados.</p>
      </div>
    }

    @if (availableUsers.length > 0) {
      <div class="user-results">
        @for (user of availableUsers; track user) {
          <div class="user-card">
            <img [src]="user.photoURL || defaultAvatar" alt="{{ user.nickname }}" class="avatar" />
            <div class="user-details">
              <span class="nickname">{{ user.nickname }}</span>
              <button class="invite-btn" (click)="toggleUserSelection(user)" [class.selected]="user.selected">
                {{ user.selected ? 'Selecionado' : 'Selecionar' }}
              </button>
            </div>
          </div>
        }
      </div>
    }

    <!-- A√ß√µes -->
    <div class="footer-actions">
      <button class="btn btn-secondary" (click)="dialogRef.close()">Cancelar</button>
      <button class="btn btn-primary" [disabled]="!isAnyUserSelected()" (click)="confirmSelection()">
        Enviar Convites
      </button>
    </div>
  </app-base-modal>
